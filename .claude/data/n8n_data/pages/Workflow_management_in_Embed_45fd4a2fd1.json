{
  "title": "Workflow management in Embed",
  "content": "Embed requires an embed license. For more information about when to use Embed, as well as costs and licensing processes, refer to [Embed](https://n8n.io/embed/) on the n8n website.\n\nWhen managing an embedded n8n deployment, spanning across teams or organizations, you will likely need to run the same (or similar) workflows for multiple users. There are two available options for doing so:\n\n| Solution                                                              | Pros                                                               | Cons                                           |\n| --------------------------------------------------------------------- | ------------------------------------------------------------------ | ---------------------------------------------- |\n| Create a workflow for each user                                       | No limitation on how workflow starts (can use any trigger)         | Requires managing multiple workflows.          |\n| Create a single workflow, and pass it user credentials when executing | Simplified workflow management (only need to change one workflow). | To run the workflow, your product must call it |\n\nThe APIs referenced in this document are subject to change at any time. Be sure the check for continued functionality with each version upgrade.\n\nThere are three general steps to follow:\n\n- Obtain the credentials for each user, and any additional parameters that may be required based on the workflow.\n- Create the [n8n credentials](../../glossary/#credential-n8n) for this user.\n- Create the workflow.\n\n### 1. Obtain user credentials\n\nHere you need to capture all credentials for any node/service this user must authenticate with, along with any additional parameters required for the particular workflow. The credentials and any parameters needed will depend on your workflow and what you are trying to do.\n\n### 2. Create user credentials\n\nAfter all relevant credential details have been obtained, you can proceed to create the relevant service credentials in n8n. This can be done using the Editor UI or API call.\n\n#### Using the Editor UI\n\n1. From the menu select **Credentials** > **New**.\n1. Use the drop-down to select the **Credential type** to create, for example *Airtable*.\n1. In the **Create New Credentials** modal, enter the corresponding credentials details for the user, and select the nodes that will have access to these credentials.\n1. Click **Create** to finish and save.\n\nThe frontend API used by the Editor UI can also be called to achieve the same result. The API endpoint is in the format: `https://<n8n-domain>/rest/credentials`.\n\nFor example, to create the credentials in the Editor UI example above, the request would be:\n\nWith the request body:\n\nThe response will contain the ID of the new credentials, which you will use when creating the workflow for this user:\n\n### 3. Create the workflow\n\nBest practice is to have a “base” workflow that you then duplicate and customize for each new user with their credentials (and any other details).\n\nYou can duplicate and customize your template workflow using either the Editor UI or API call.\n\n#### Using the Editor UI\n\n1. From the menu select **Workflows** > **Open** to open the template workflow to be duplicated.\n1. Select **Workflows** > **Duplicate**, then enter a name for this new workflow and click **Save**.\n1. Update all relevant nodes to use the credentials for this user (created above).\n1. **Save** this workflow set it to **Active** using the toggle in the top-right corner.\n\n1. Fetch the JSON of the template workflow using the endpoint: `https://<n8n-domain>/rest/workflows/<workflow_id>`\n\nThe response will contain the JSON data of the selected workflow:\n\n1. Save the returned JSON data and update any relevant credentials and fields for the new user.\n\n1. Create a new workflow using the updated JSON as the request body at endpoint: `https://<n8n-domain>/rest/workflows`\n\nThe response will contain the ID of the new workflow, which you will use in the next step.\n\n1. Lastly, activate the new workflow:\n\nPassing the additional value `active` in your JSON payload:\n\nThere are four steps to follow to implement this method:\n\n- Obtain the credentials for each user, and any additional parameters that may be required based on the workflow. See [Obtain user credentials](#1-obtain-user-credentials) above.\n- Create the n8n credentials for this user. See [Create user credentials](#2-create-user-credentials) above.\n- Create the workflow.\n- Call the workflow as needed.\n\n### Create the workflow\n\nThe details and scope of this workflow will vary greatly according to the individual use case, however there are a few design implementations to keep in mind:\n\n- This workflow must be triggered by a [Webhook](../../integrations/builtin/core-nodes/n8n-nodes-base.webhook/) node.\n- The incoming webhook call must contain the user’s credentials and any other workflow parameters required.\n- Each node where the user’s credentials are needed should use an [expression](../../code/expressions/) so that the node’s credential field reads the credential provided in the webhook call.\n- Save and activate the workflow, ensuring the production URL is selected for the Webhook node. Refer to [webhook node](../../integrations/builtin/core-nodes/n8n-nodes-base.webhook/) for more information.\n\n### Call the workflow\n\nFor each new user, or for any existing user as may be needed, call the webhook defined as the workflow trigger and provide the necessary credentials (and any other workflow parameters).",
  "code_samples": [
    {
      "code": "POST https://<n8n-domain>/rest/credentials",
      "language": "unknown"
    },
    {
      "code": "{\n   \"name\":\"MyAirtable\",\n   \"type\":\"airtableApi\",\n   \"nodesAccess\":[\n      {\n         \"nodeType\":\"n8n-nodes-base.airtable\"\n      }\n   ],\n   \"data\":{\n      \"apiKey\":\"q12we34r5t67yu\"\n   }\n}",
      "language": "unknown"
    },
    {
      "code": "{\n   \"data\":{\n      \"name\":\"MyAirtable\",\n      \"type\":\"airtableApi\",\n      \"data\":{\n         \"apiKey\":\"q12we34r5t67yu\"\n      },\n      \"nodesAccess\":[\n         {\n            \"nodeType\":\"n8n-nodes-base.airtable\",\n            \"date\":\"2021-09-10T07:41:27.770Z\"\n         }\n      ],\n      \"id\":\"29\",\n      \"createdAt\":\"2021-09-10T07:41:27.777Z\",\n      \"updatedAt\":\"2021-09-10T07:41:27.777Z\"\n   }\n}",
      "language": "unknown"
    },
    {
      "code": "GET https://<n8n-domain>/rest/workflows/1012",
      "language": "unknown"
    },
    {
      "code": "{\n  \"data\": {\n    \"id\": \"1012\",\n    \"name\": \"Nathan's Workflow\",\n    \"active\": false,\n    \"nodes\": [\n      {\n        \"parameters\": {},\n        \"name\": \"Start\",\n        \"type\": \"n8n-nodes-base.start\",\n        \"typeVersion\": 1,\n        \"position\": [\n          130,\n          640\n        ]\n      },\n      {\n        \"parameters\": {\n          \"authentication\": \"headerAuth\",\n          \"url\": \"https://internal.users.n8n.cloud/webhook/custom-erp\",\n          \"options\": {\n            \"splitIntoItems\": true\n          },\n          \"headerParametersUi\": {\n            \"parameter\": [\n              {\n                \"name\": \"unique_id\",\n                \"value\": \"recLhLYQbzNSFtHNq\"\n              }\n            ]\n          }\n        },\n        \"name\": \"HTTP Request\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 1,\n        \"position\": [\n          430,\n          300\n        ],\n        \"credentials\": {\n          \"httpHeaderAuth\": \"beginner_course\"\n        }\n      },\n      {\n        \"parameters\": {\n          \"operation\": \"append\",\n          \"application\": \"appKBGQfbm6NfW6bv\",\n          \"table\": \"processingOrders\",\n          \"options\": {}\n        },\n        \"name\": \"Airtable\",\n        \"type\": \"n8n-nodes-base.airtable\",\n        \"typeVersion\": 1,\n        \"position\": [\n          990,\n          210\n        ],\n        \"credentials\": {\n          \"airtableApi\": \"Airtable\"\n        }\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"string\": [\n              {\n                \"value1\": \"={{$json[\\\"orderStatus\\\"]}}\",\n                \"value2\": \"processing\"\n              }\n            ]\n          }\n        },\n        \"name\": \"IF\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 1,\n        \"position\": [\n          630,\n          300\n        ]\n      },\n      {\n        \"parameters\": {\n          \"keepOnlySet\": true,\n          \"values\": {\n            \"number\": [\n              {\n                \"name\": \"=orderId\",\n                \"value\": \"={{$json[\\\"orderID\\\"]}}\"\n              }\n            ],\n            \"string\": [\n              {\n                \"name\": \"employeeName\",\n                \"value\": \"={{$json[\\\"employeeName\\\"]}}\"\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"name\": \"Set\",\n        \"type\": \"n8n-nodes-base.set\",\n        \"typeVersion\": 1,\n        \"position\": [\n          800,\n          210\n        ]\n      },\n      {\n        \"parameters\": {\n          \"functionCode\": \"let totalBooked = items.length;\\nlet bookedSum = 0;\\n\\nfor(let i=0; i < items.length; i++) {\\n  bookedSum = bookedSum + items[i].json.orderPrice;\\n}\\nreturn [{json:{totalBooked, bookedSum}}]\\n\"\n        },\n        \"name\": \"Function\",\n        \"type\": \"n8n-nodes-base.function\",\n        \"typeVersion\": 1,\n        \"position\": [\n          800,\n          400\n        ]\n      },\n      {\n        \"parameters\": {\n          \"webhookUri\": \"https://discord.com/api/webhooks/865213348202151968/oD5_WPDQwtr22Vjd_82QP3-_4b_lGhAeM7RynQ8Js5DzyXrQEnj0zeAQIA6fki1JLtXE\",\n          \"text\": \"=This week we have {{$json[\\\"totalBooked\\\"]}} booked orders with a total value of {{$json[\\\"bookedSum\\\"]}}. My Unique ID: {{$node[\\\"HTTP Request\\\"].parameter[\\\"headerParametersUi\\\"][\\\"parameter\\\"][0][\\\"value\\\"]}}\"\n        },\n        \"name\": \"Discord\",\n        \"type\": \"n8n-nodes-base.discord\",\n        \"typeVersion\": 1,\n        \"position\": [\n          1000,\n          400\n        ]\n      },\n      {\n        \"parameters\": {\n          \"triggerTimes\": {\n            \"item\": [\n              {\n                \"mode\": \"everyWeek\",\n                \"hour\": 9\n              }\n            ]\n          }\n        },\n        \"name\": \"Cron\",\n        \"type\": \"n8n-nodes-base.cron\",\n        \"typeVersion\": 1,\n        \"position\": [\n          220,\n          300\n        ]\n      }\n    ],\n    \"connections\": {\n      \"HTTP Request\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"IF\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Start\": {\n        \"main\": [\n          []\n        ]\n      },\n      \"IF\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Set\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Function\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Set\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Airtable\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Function\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Discord\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Cron\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"HTTP Request\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      }\n    },\n    \"createdAt\": \"2021-07-16T11:15:46.066Z\",\n    \"updatedAt\": \"2021-07-16T12:05:44.045Z\",\n    \"settings\": {},\n    \"staticData\": null,\n    \"tags\": []\n  }\n}",
      "language": "unknown"
    },
    {
      "code": "POST https://<n8n-domain>/rest/workflows/",
      "language": "unknown"
    },
    {
      "code": "PATCH https://<n8n-domain>/rest/workflows/1012",
      "language": "unknown"
    },
    {
      "code": "// ...\n\"active\":true,\n\"settings\": {},\n\"staticData\": null,\n\"tags\": []",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Workflow per user",
      "id": "workflow-per-user"
    },
    {
      "level": "h3",
      "text": "1. Obtain user credentials",
      "id": "1.-obtain-user-credentials"
    },
    {
      "level": "h3",
      "text": "2. Create user credentials",
      "id": "2.-create-user-credentials"
    },
    {
      "level": "h3",
      "text": "3. Create the workflow",
      "id": "3.-create-the-workflow"
    },
    {
      "level": "h2",
      "text": "Single workflow",
      "id": "single-workflow"
    },
    {
      "level": "h3",
      "text": "Create the workflow",
      "id": "create-the-workflow"
    },
    {
      "level": "h3",
      "text": "Call the workflow",
      "id": "call-the-workflow"
    }
  ],
  "url": "llms-txt#workflow-management-in-embed",
  "links": []
}
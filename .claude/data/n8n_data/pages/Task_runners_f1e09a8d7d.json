{
  "title": "Task runners",
  "content": "Task runners are a generic mechanism to execute tasks in a secure and performant way. They're used to execute user-provided JavaScript and Python code in the [Code node](../../../integrations/builtin/core-nodes/n8n-nodes-base.code/).\n\nTask runner support for native Python and the `n8nio/runners` image are in beta. Until this feature is stable, you must use the `N8N_NATIVE_PYTHON_RUNNER=true` environment variable to enable the Python runner.\n\nThis document describes how task runners work and how you can configure them.\n\nThe task runner feature consists of these components: one or more task runners, a task broker, and a task requester.\n\nTask runners connect to the task broker using a websocket connection. A task requester submits a task request to the broker where an available task runner can pick it up for execution.\n\nThe runner executes the task and submits the results to the task requester. The task broker coordinates communication between the runner and the requester.\n\nThe n8n instance (main and worker) acts as the broker. The Code node in this case is the task requester.\n\nYou can use task runners in two different modes: internal and external.\n\nIn internal mode, the n8n instance launches the task runner as a child process. The n8n process monitors and manages the life cycle of the task runner. The task runner process shares the same `uid` and `gid` as n8n. This is **not** recommended for production.\n\nIn external mode, a [launcher application](https://github.com/n8n-io/task-runner-launcher) launches task runners on demand and manages their lifecycle. Typically, this means that next to n8n you add a sidecar container running the [`n8nio/runners`](https://hub.docker.com/r/n8nio/runners) image containing the launcher, the JS task runner and the Python task runner. This sidecar container is independent from the n8n instance.\n\nWhen using [Queue mode](../../scaling/queue-mode/), each worker needs to have its own sidecar container for task runners.\n\nIn addition, if you haven't enabled offloading manual executions to workers (if you aren't setting `OFFLOAD_MANUAL_EXECUTIONS_TO_WORKERS=true` in your configuration), then your main instance will run manual executions and needs its own sidecar container for task runners as well. Please note that running n8n with offloading disabled isn't recommended for production.\n\n## Setting up external mode\n\nIn external mode, you run the `n8nio/runners` image as a sidecar container next to n8n. Below you will find a docker compose as a reference. Keep in mind that the `n8nio/runners` image version must match that of the `n8nio/n8n` image, and the n8n version must be >=1.111.0.\n\n### Configuring n8n container in external mode\n\nThese are the main environment variables that you can set on the n8n container running in external mode:\n\n| Environment variables                                  | Description                                                                                                                                                                   |\n| ------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `N8N_RUNNERS_ENABLED=true`                             | Enables task runners.                                                                                                                                                         |\n| `N8N_RUNNERS_MODE=external`                            | Use task runners in external mode.                                                                                                                                            |\n| `N8N_RUNNERS_AUTH_TOKEN=<random secure shared secret>` | A shared secret task runners use to connect to the broker.                                                                                                                    |\n| `N8N_RUNNERS_BROKER_LISTEN_ADDRESS=0.0.0.0`            | By default, the task broker only listens to localhost. When using multiple containers (for example, with Docker Compose), it needs to be able to accept external connections. |\n\nFor full list of environment variables see [task runner environment variables](../environment-variables/task-runners/).\n\n### Configuring runners container in external mode\n\nThese are the main environment variables that you can set on the runners container running in external mode:\n\n| Environment variables                                  | Description                                                                                                                                                                                                                 |\n| ------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `N8N_RUNNERS_AUTH_TOKEN=<random secure shared secret>` | The shared secret the task runner uses to connect to the broker.                                                                                                                                                            |\n| `N8N_RUNNERS_TASK_BROKER_URI=localhost:5679`           | The address of the task broker server within the n8n instance.                                                                                                                                                              |\n| `N8N_RUNNERS_AUTO_SHUTDOWN_TIMEOUT=15`                 | Number of seconds of inactivity to wait before shutting down the task runner process. The launcher will automatically start the runner again when there are new tasks to execute. Set to `0` to disable automatic shutdown. |\n\nFor full list of environment variables see [task runner environment variables](../environment-variables/task-runners/).\n\n### Configuring launcher in runners container in external mode\n\nThe launcher will read environment variables from runners container environment, and will pass them along to each runner as defined in the [default launcher configuration file](https://github.com/n8n-io/n8n/blob/master/docker/images/runners/n8n-task-runners.json), located in the container at `/etc/task-runners.json`. The default launcher configuration file is locked down, but you will likely want to edit this file, for example, to allowlist first- or third-party modules. To customize the launcher configuration file, mount to this path:\n\nFor further information about the launcher config file, see [here](https://github.com/n8n-io/task-runner-launcher/blob/main/docs/setup.md#config-file).\n\n## Adding extra dependencies\n\nYou can customize the `n8nio/runners` image. To do so, you will find the runners Dockerfile at [this directory](https://github.com/n8n-io/n8n/tree/master/docker/images/runners) in the n8n repository. The manifests referred to below are also found in this directory.\n\nTo make additional packages available on the Code node, you can bake extra packages into your custom runners image at build time:\n\n- JavaScript: edit `docker/images/runners/package.json` (package.json manifest used to install runtime-only deps into the JS runner)\n- Python (Native): edit `docker/images/runners/extras.txt` (requirements.txt-style list installed into the Python runner venv)\n\n> Important: for security, any external libraries must be explicitly allowed for Code node use. Update `n8n-task-runners.json` to allowlist what you add.\n\n### 1) JavaScript packages\n\nEdit the runtime extras manifest `docker/images/runners/package.json`:\n\nAdd any packages you want under `\"dependencies\"` (pin them for reproducibility), e.g.:\n\n### 2) Python packages\n\nEdit the requirements file `docker/images/runners/extras.txt`:",
  "code_samples": [
    {
      "code": "services:\n  n8n:\n    image: n8nio/n8n:1.111.0\n    container_name: n8n-main\n    environment:\n      - N8N_RUNNERS_ENABLED=true\n      - N8N_RUNNERS_MODE=external\n      - N8N_RUNNERS_BROKER_LISTEN_ADDRESS=0.0.0.0\n      - N8N_RUNNERS_AUTH_TOKEN=your-secret-here\n      - N8N_NATIVE_PYTHON_RUNNER=true\n    ports:\n      - \"5678:5678\"\n    volumes:\n      - n8n_data:/home/node/.n8n\n    # etc.\n\n  task-runners:\n    image: n8nio/runners:1.111.0\n    container_name: n8n-runners\n    environment:\n      - N8N_RUNNERS_TASK_BROKER_URI=http://n8n-main:5679\n      - N8N_RUNNERS_AUTH_TOKEN=your-secret-here\n      # etc.\n    depends_on:\n      - n8n\n\nvolumes:\n  n8n_data:",
      "language": "unknown"
    },
    {
      "code": "path/to/n8n-task-runners.json:/etc/n8n-task-runners.json",
      "language": "unknown"
    },
    {
      "code": "{\n  \"name\": \"task-runner-runtime-extras\",\n  \"description\": \"Runtime-only deps for the JS task-runner image, installed at image build.\",\n  \"private\": true,\n  \"dependencies\": {\n    \"moment\": \"2.30.1\"\n  }\n}",
      "language": "unknown"
    },
    {
      "code": "\"dependencies\": {\n  \"moment\": \"2.30.1\",\n  \"uuid\": \"9.0.0\"\n}",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "How it works",
      "id": "how-it-works"
    },
    {
      "level": "h2",
      "text": "Task runner modes",
      "id": "task-runner-modes"
    },
    {
      "level": "h3",
      "text": "Internal mode",
      "id": "internal-mode"
    },
    {
      "level": "h3",
      "text": "External mode",
      "id": "external-mode"
    },
    {
      "level": "h2",
      "text": "Setting up external mode",
      "id": "setting-up-external-mode"
    },
    {
      "level": "h3",
      "text": "Configuring n8n container in external mode",
      "id": "configuring-n8n-container-in-external-mode"
    },
    {
      "level": "h3",
      "text": "Configuring runners container in external mode",
      "id": "configuring-runners-container-in-external-mode"
    },
    {
      "level": "h3",
      "text": "Configuring launcher in runners container in external mode",
      "id": "configuring-launcher-in-runners-container-in-external-mode"
    },
    {
      "level": "h2",
      "text": "Adding extra dependencies",
      "id": "adding-extra-dependencies"
    },
    {
      "level": "h3",
      "text": "1) JavaScript packages",
      "id": "1)-javascript-packages"
    },
    {
      "level": "h3",
      "text": "2) Python packages",
      "id": "2)-python-packages"
    }
  ],
  "url": "llms-txt#task-runners",
  "links": []
}
{
  "title": "Workflow 2: Generating reports",
  "content": "In this workflow, you will merge data from different sources, transform binary data, generate files, and send notifications about them. The final workflow should look like this:\n\n*Workflow 2 for aggregating data and generating files*\n\nTo make things easier, let's split the workflow into three parts.\n\n## Part 1: Getting data from different sources\n\nThe first part of the workflow consists of five nodes:\n\n*Workflow 1: Getting data from different sources*\n\n1. Use the [**HTTP Request node**](../../../../integrations/builtin/core-nodes/n8n-nodes-base.httprequest/) to get data from the API endpoint that stores company data. Configure the following node parameters:\n\n- **Method**: Get\n   - **URL**: The **Dataset URL** you received in the email when you signed up for this course.\n   - **Authentication**: Generic Credential Type\n     - **Generic Auth Type**: Header Auth\n     - **Credentials for Header Auth**: The Header Auth name and Header Auth value you received in the email when you signed up for this course.\n   - **Send Headers**: Toggle to true\n     - **Specify Headers**: Select `Using Fields Below`\n     - **Name**: `unique_id`\n     - **Value**: The unique ID you received in the email when you signed up for this course.\n\n1. Use the [**Airtable node**](../../../../integrations/builtin/app-nodes/n8n-nodes-base.airtable/) to list data from the `customers` table (where you updated the fields `region` and `subregion`).\n\n1. Use the [**Merge node**](../../../../integrations/builtin/core-nodes/n8n-nodes-base.merge/) to merge data from the Airtable and HTTP Request node, based on matching the input fields for `customerID`.\n\n1. Use the [**Sort node**](../../../../integrations/builtin/core-nodes/n8n-nodes-base.sort/) to sort data by `orderPrice` in descending order.\n\n- What's the name of the employee assigned to customer 1?\n- What's the order status of customer 2?\n- What's the highest order price?\n\n## Part 2: Generating file for regional sales\n\nThe second part of the workflow consists of four nodes:\n\n*Workflow 2: Generating file for regional sales*\n\n1. Use the [**If node**](../../../../integrations/builtin/core-nodes/n8n-nodes-base.if/) to filter to only display orders from the region `Americas`.\n1. Use the [**Convert to File**](../../../../integrations/builtin/core-nodes/n8n-nodes-base.converttofile/) to transform the incoming data from JSON to binary format. Convert each item to a separate file. (Bonus points if you can figure out how to name each report based on the orderID!)\n1. Use the [**Gmail node**](../../../../integrations/builtin/app-nodes/n8n-nodes-base.gmail/) (or another email node) to send the files using email to an address you have access to. Note that you need to add an attachment with the data property.\n1. Use the [**Discord node**](../../../../integrations/builtin/app-nodes/n8n-nodes-base.discord/) to send a message in the n8n Discord channel `#course-level-two`. In the node, configure the following parameters:\n   - **Webhook URL**: The Discord URL you received in the email when you signed up for this course.\n   - **Text**: \"I sent the file using email with the label ID `{label ID}`. My ID: \" followed by the unique ID emailed to you when you registered for this course.\\\n     Note that you need to replace the text in curly braces `{}` with [expressions](../../../../glossary/#expression-n8n) that reference the data from the nodes.\n\n- How many orders are assigned to the `Americas` region?\n- What's the total price of the orders in the `Americas` region?\n- How many items does the **Write Binary File node** return?\n\n## Part 3: Generating files for total sales\n\nThe third part of the workflow consists of five nodes:\n\n*Workflow 3: Generating files for total sales*\n\n1. Use the [**Loop Over Items node**](../../../../integrations/builtin/core-nodes/n8n-nodes-base.splitinbatches/) to split data from the Item Lists node into batches of 5.\n1. Use the [**Set node**](../../../../integrations/builtin/core-nodes/n8n-nodes-base.set/) to set four values, referenced with expressions from the previous node: `customerEmail`, `customerRegion`, `customerSince`, and `orderPrice`.\n1. Use the [**Date & Time node**](../../../../integrations/builtin/core-nodes/n8n-nodes-base.datetime/) to change the date format of the field `customerSince` to the format MM/DD/YYYY.\n   - Set the **Include Input Fields** option to keep all the data together.\n1. Use the [**Convert to File node**](../../../../integrations/builtin/core-nodes/n8n-nodes-base.converttofile/) to create a CSV spreadsheet with the file name set as the expression: `{{$runIndex > 0 ? 'file_low_orders':'file_high_orders'}}`.\n1. Use the [**Discord node**](../../../../integrations/builtin/app-nodes/n8n-nodes-base.discord/) to send a message in the n8n Discord channel `#course-level-two`. In the node, configure the following parameters:\n   - **Webhook URL**: The Discord URL you received in the email when you signed up for this course.\n   - **Text**: \"I created the spreadsheet `{file name}`. My ID:\" followed by the unique ID emailed to you when you registered for this course.\\\n     Note that you need to replace `{file name}` with an expression that references data from the previous **Convert to File node**.\n\n- What's the lowest order price in the first batch of items?\n- What's the formatted date of customer 7?\n- How many items does the **Convert to File node** return?\n\nTo check the configuration of the nodes, you can copy the JSON workflow code below and paste it into your Editor UI:",
  "code_samples": [
    {
      "code": "{\n\"meta\": {\n    \"templateCredsSetupCompleted\": true,\n    \"instanceId\": \"cb484ba7b742928a2048bf8829668bed5b5ad9787579adea888f05980292a4a7\"\n},\n\"nodes\": [\n    {\n    \"parameters\": {\n        \"sendTo\": \"bart@n8n.io\",\n        \"subject\": \"Your TPS Reports\",\n        \"emailType\": \"text\",\n        \"message\": \"Please find your TPS report attached.\",\n        \"options\": {\n        \"attachmentsUi\": {\n            \"attachmentsBinary\": [\n            {}\n            ]\n        }\n        }\n    },\n    \"id\": \"d889eb42-8b34-4718-b961-38c8e7839ea6\",\n    \"name\": \"Gmail\",\n    \"type\": \"n8n-nodes-base.gmail\",\n    \"typeVersion\": 2.1,\n    \"position\": [\n        2100,\n        500\n    ],\n    \"credentials\": {\n        \"gmailOAuth2\": {\n        \"id\": \"HFesCcFcn1NW81yu\",\n        \"name\": \"Gmail account 7\"\n        }\n    }\n    },\n    {\n    \"parameters\": {},\n    \"id\": \"c0236456-40be-4f8f-a730-e56cb62b7b5c\",\n    \"name\": \"When clicking \\\"Execute workflow\\\"\",\n    \"type\": \"n8n-nodes-base.manualTrigger\",\n    \"typeVersion\": 1,\n    \"position\": [\n        780,\n        600\n    ]\n    },\n    {\n    \"parameters\": {\n        \"url\": \"https://internal.users.n8n.cloud/webhook/level2-erp\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n        \"parameters\": [\n            {\n            \"name\": \"unique_id\",\n            \"value\": \"recFIcD6UlSyxaVMQ\"\n            }\n        ]\n        },\n        \"options\": {}\n    },\n    \"id\": \"cc106fa0-6630-4c84-aea4-a4c7a3c149e9\",\n    \"name\": \"HTTP Request\",\n    \"type\": \"n8n-nodes-base.httpRequest\",\n    \"typeVersion\": 4.1,\n    \"position\": [\n        1000,\n        500\n    ],\n    \"credentials\": {\n        \"httpHeaderAuth\": {\n        \"id\": \"qeHdJdqqqaTC69cm\",\n        \"name\": \"Course L2 Credentials\"\n        }\n    }\n    },\n    {\n    \"parameters\": {\n        \"operation\": \"search\",\n        \"base\": {\n        \"__rl\": true,\n        \"value\": \"apprtKkVasbQDbFa1\",\n        \"mode\": \"list\",\n        \"cachedResultName\": \"All your base\",\n        \"cachedResultUrl\": \"https://airtable.com/apprtKkVasbQDbFa1\"\n        },\n        \"table\": {\n        \"__rl\": true,\n        \"value\": \"tblInZ7jeNdlUOvxZ\",\n        \"mode\": \"list\",\n        \"cachedResultName\": \"Course L2, Workflow 1\",\n        \"cachedResultUrl\": \"https://airtable.com/apprtKkVasbQDbFa1/tblInZ7jeNdlUOvxZ\"\n        },\n        \"options\": {}\n    },\n    \"id\": \"e5ae1927-b531-401c-9cb2-ecf1f2836ba6\",\n    \"name\": \"Airtable\",\n    \"type\": \"n8n-nodes-base.airtable\",\n    \"typeVersion\": 2,\n    \"position\": [\n        1000,\n        700\n    ],\n    \"credentials\": {\n        \"airtableTokenApi\": {\n        \"id\": \"MIplo6lY3AEsdf7L\",\n        \"name\": \"Airtable Personal Access Token account 4\"\n        }\n    }\n    },\n    {\n    \"parameters\": {\n        \"mode\": \"combine\",\n        \"mergeByFields\": {\n        \"values\": [\n            {\n            \"field1\": \"customerID\",\n            \"field2\": \"customerID\"\n            }\n        ]\n        },\n        \"options\": {}\n    },\n    \"id\": \"1cddc984-7fca-45e0-83b8-0c502cb4c78c\",\n    \"name\": \"Merge\",\n    \"type\": \"n8n-nodes-base.merge\",\n    \"typeVersion\": 2.1,\n    \"position\": [\n        1220,\n        600\n    ]\n    },\n    {\n    \"parameters\": {\n        \"sortFieldsUi\": {\n        \"sortField\": [\n            {\n            \"fieldName\": \"orderPrice\",\n            \"order\": \"descending\"\n            }\n        ]\n        },\n        \"options\": {}\n    },\n    \"id\": \"2f55af2e-f69b-4f61-a9e5-c7eefaad93ba\",\n    \"name\": \"Sort\",\n    \"type\": \"n8n-nodes-base.sort\",\n    \"typeVersion\": 1,\n    \"position\": [\n        1440,\n        600\n    ]\n    },\n    {\n    \"parameters\": {\n        \"conditions\": {\n        \"options\": {\n            \"caseSensitive\": true,\n            \"leftValue\": \"\",\n            \"typeValidation\": \"strict\"\n        },\n        \"conditions\": [\n            {\n            \"id\": \"d3afe65c-7c80-4caa-9d1c-33c62fbc2197\",\n            \"leftValue\": \"={{ $json.region }}\",\n            \"rightValue\": \"Americas\",\n            \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"equals\",\n                \"name\": \"filter.operator.equals\"\n            }\n            }\n        ],\n        \"combinator\": \"and\"\n        },\n        \"options\": {}\n    },\n    \"id\": \"2ed874a9-5bcf-4cc9-9b52-ea503a562892\",\n    \"name\": \"If\",\n    \"type\": \"n8n-nodes-base.if\",\n    \"typeVersion\": 2,\n    \"position\": [\n        1660,\n        500\n    ]\n    },\n    {\n    \"parameters\": {\n        \"operation\": \"toJson\",\n        \"mode\": \"each\",\n        \"options\": {\n        \"fileName\": \"=report_orderID_{{ $('If').item.json.orderID }}.json\"\n        }\n    },\n    \"id\": \"d93b4429-2200-4a84-8505-16266fedfccd\",\n    \"name\": \"Convert to File\",\n    \"type\": \"n8n-nodes-base.convertToFile\",\n    \"typeVersion\": 1.1,\n    \"position\": [\n        1880,\n        500\n    ]\n    },\n    {\n    \"parameters\": {\n        \"authentication\": \"webhook\",\n        \"content\": \"I sent the file using email with the label ID  and wrote the binary file {file name}. My ID: 123\",\n        \"options\": {}\n    },\n    \"id\": \"26f43f2c-1422-40de-9f40-dd2d80926b1c\",\n    \"name\": \"Discord\",\n    \"type\": \"n8n-nodes-base.discord\",\n    \"typeVersion\": 2,\n    \"position\": [\n        2320,\n        500\n    ],\n    \"credentials\": {\n        \"discordWebhookApi\": {\n        \"id\": \"WEBrtPdoLrhlDYKr\",\n        \"name\": \"L2 Course Discord Webhook account\"\n        }\n    }\n    },\n    {\n    \"parameters\": {\n        \"batchSize\": 5,\n        \"options\": {}\n    },\n    \"id\": \"0fa1fbf6-fe77-4044-a445-c49a1db37dec\",\n    \"name\": \"Loop Over Items\",\n    \"type\": \"n8n-nodes-base.splitInBatches\",\n    \"typeVersion\": 3,\n    \"position\": [\n        1660,\n        700\n    ]\n    },\n    {\n    \"parameters\": {\n        \"assignments\": {\n        \"assignments\": [\n            {\n            \"id\": \"ce839b80-c50d-48f5-9a24-bb2df6fdd2ff\",\n            \"name\": \"customerEmail\",\n            \"value\": \"={{ $json.customerEmail }}\",\n            \"type\": \"string\"\n            },\n            {\n            \"id\": \"0c613366-3808-45a2-89cc-b34c7b9f3fb7\",\n            \"name\": \"region\",\n            \"value\": \"={{ $json.region }}\",\n            \"type\": \"string\"\n            },\n            {\n            \"id\": \"0f19a88c-deb0-4119-8965-06ed62a840b2\",\n            \"name\": \"customerSince\",\n            \"value\": \"={{ $json.customerSince }}\",\n            \"type\": \"string\"\n            },\n            {\n            \"id\": \"a7e890d6-86af-4839-b5df-d2a4efe923f7\",\n            \"name\": \"orderPrice\",\n            \"value\": \"={{ $json.orderPrice }}\",\n            \"type\": \"number\"\n            }\n        ]\n        },\n        \"options\": {}\n    },\n    \"id\": \"09b8584c-4ead-4007-a6cd-edaa4669a757\",\n    \"name\": \"Edit Fields\",\n    \"type\": \"n8n-nodes-base.set\",\n    \"typeVersion\": 3.3,\n    \"position\": [\n        1880,\n        700\n    ]\n    },\n    {\n    \"parameters\": {\n        \"operation\": \"formatDate\",\n        \"date\": \"={{ $json.customerSince }}\",\n        \"options\": {\n        \"includeInputFields\": true\n        }\n    },\n    \"id\": \"c96fae90-e080-48dd-9bff-3e4506aafb86\",\n    \"name\": \"Date & Time\",\n    \"type\": \"n8n-nodes-base.dateTime\",\n    \"typeVersion\": 2,\n    \"position\": [\n        2100,\n        700\n    ]\n    },\n    {\n    \"parameters\": {\n        \"options\": {\n        \"fileName\": \"={{$runIndex > 0 ? 'file_low_orders':'file_high_orders'}}\"\n        }\n    },\n    \"id\": \"43dc8634-2f16-442b-a754-89f47c51c591\",\n    \"name\": \"Convert to File1\",\n    \"type\": \"n8n-nodes-base.convertToFile\",\n    \"typeVersion\": 1.1,\n    \"position\": [\n        2320,\n        700\n    ]\n    },\n    {\n    \"parameters\": {\n        \"authentication\": \"webhook\",\n        \"content\": \"I created the spreadsheet {file name}. My ID: 123\",\n        \"options\": {}\n    },\n    \"id\": \"05da1c22-d1f6-4ea6-9102-f74f9ae2e9d3\",\n    \"name\": \"Discord1\",\n    \"type\": \"n8n-nodes-base.discord\",\n    \"typeVersion\": 2,\n    \"position\": [\n        2540,\n        700\n    ],\n    \"credentials\": {\n        \"discordWebhookApi\": {\n        \"id\": \"WEBrtPdoLrhlDYKr\",\n        \"name\": \"L2 Course Discord Webhook account\"\n        }\n    }\n    }\n],\n\"connections\": {\n    \"Gmail\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Discord\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"When clicking \\\"Execute workflow\\\"\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"HTTP Request\",\n            \"type\": \"main\",\n            \"index\": 0\n        },\n        {\n            \"node\": \"Airtable\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"HTTP Request\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"Airtable\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n        }\n        ]\n    ]\n    },\n    \"Merge\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Sort\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"Sort\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n        },\n        {\n            \"node\": \"If\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"If\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Convert to File\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"Convert to File\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Gmail\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"Loop Over Items\": {\n    \"main\": [\n        null,\n        [\n        {\n            \"node\": \"Edit Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"Edit Fields\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Date & Time\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"Date & Time\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Convert to File1\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"Convert to File1\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Discord1\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    },\n    \"Discord1\": {\n    \"main\": [\n        [\n        {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n        }\n        ]\n    ]\n    }\n},\n\"pinData\": {}\n}",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Part 1: Getting data from different sources",
      "id": "part-1:-getting-data-from-different-sources"
    },
    {
      "level": "h2",
      "text": "Part 2: Generating file for regional sales",
      "id": "part-2:-generating-file-for-regional-sales"
    },
    {
      "level": "h2",
      "text": "Part 3: Generating files for total sales",
      "id": "part-3:-generating-files-for-total-sales"
    }
  ],
  "url": "llms-txt#workflow-2:-generating-reports",
  "links": []
}
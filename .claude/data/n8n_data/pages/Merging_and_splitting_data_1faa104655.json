{
  "title": "Merging and splitting data",
  "content": "In this chapter, you will learn how to merge and split data, and in what cases it might be useful to perform these operations.\n\nIn some cases, you might need to merge (combine) and process data from different sources.\n\nMerging data can involve:\n\n- Creating one data set from multiple sources.\n- Synchronizing data between multiple systems. This could include removing duplicate data or updating data in one system when it changes in another.\n\nOne-way vs. two-way sync\n\nIn a one-way sync, data is synchronized in one direction. One system serves as the single source of truth. When information changes in that main system, it automatically changes in the secondary system; but if information changes in the secondary system, the changes aren't reflected in the main system.\n\nIn a two-way sync, data is synchronized in both directions (between both systems). When information changes in either of the two systems, it automatically changes in the other one as well.\n\n[This blog tutorial](https://blog.n8n.io/how-to-sync-data-between-two-systems/) explains how to sync data one-way and two-way between two CRMs.\n\nIn n8n, you can merge data from two different nodes using the [Merge node](../../../integrations/builtin/core-nodes/n8n-nodes-base.merge/), which provides several merging options:\n\n- [Append](../../../integrations/builtin/core-nodes/n8n-nodes-base.merge/#append)\n- [Combine](../../../integrations/builtin/core-nodes/n8n-nodes-base.merge/#combine)\n  - [Merge by Fields](../../../integrations/builtin/core-nodes/n8n-nodes-base.merge/#combine-by-matching-fields): requires input fields to match on\n  - [Merge by Position](../../../integrations/builtin/core-nodes/n8n-nodes-base.merge/#combine-by-position)\n  - [Combine all possible combinations](../../../integrations/builtin/core-nodes/n8n-nodes-base.merge/#combine-by-all-possible-combinations)\n- [Choose Branch](../../../integrations/builtin/core-nodes/n8n-nodes-base.merge/#choose-branch)\n\nNotice that Combine > Merge by Fields requires you enter input fields to match on. These fields should contain identical values between the data sources so n8n can properly match data together. In the **Merge node**, they're called `Input 1 Field` and `Input 2 Field`.\n\n*Property Input fields in the Merge node*\n\nProperty Input in dot notation\n\nIf you want to reference nested values in the **Merge node** parameters `Input 1 Field` and `Input 2 Field`, you need to enter the property key in dot-notation format (as text, not as an expression).\n\nYou can also find the **Merge node** under the alias Join. This might be more intuitive if you're familiar with SQL joins.\n\nBuild a workflow that merges data from the Customer Datastore node and Code node.\n\n1. Add a **Merge node** that takes `Input 1` from a **Customer Datastore node** and `Input 2` from a **Code node**.\n1. In the **Customer Datastore node**, run the operation **Get All People**.\n1. In the **Code node**, create an array of two objects with three properties: `name`, `language`, and `country`, where the property `country` has two sub-properties `code` and `name`.\n   - Fill out the values of these properties with the information of two characters from the Customer Database.\n   - For example, Jay Gatsby's language is English and country name is United States.\n1. In the **Merge node**, try out different merge options.\n\nThe workflow for this exercise looks like this:\n\n*Workflow exercise for merging data*\n\nIf you merge data with the option **Keep Matches** using the name as the input fields to match, the result should look like this (note this example only contains Jay Gatsby; yours might look different depending on which characters you selected):\n\n*Output of Merge node with option to keep matches*\n\nTo check the configuration of the nodes, you can copy the JSON workflow code below and paste it into your Editor UI:\n\nIn some cases, you might need to perform the same operation on each element of an array or each data item (for example sending a message to every contact in your address book). In technical terms, you need to iterate through the data (with loops).\n\nn8n generally handles this repetitive processing automatically, as the nodes run once for each item, so you don't need to build loops into your workflows.\n\nHowever, there are some [exceptions of nodes and operations](../../../flow-logic/looping/#node-exceptions) that will require you to build a loop into your workflow.\n\nTo [create a loop in an n8n workflow](../../../flow-logic/looping/#using-loops-in-n8n), you need to connect the output of one node to the input of a previous node, and add an **If node** to check when to stop the loop.\n\n## Splitting data in batches\n\nIf you need to process large volumes of incoming data, execute the **Code node** multiple times, or avoid API rate limits, it's best to split the data into batches (groups) and process these batches.\n\nFor these processes, use the [**Loop Over Items node**](../../../integrations/builtin/core-nodes/n8n-nodes-base.splitinbatches/). This node splits input data into a specified batch size and, with each iteration, returns a predefined amount of data.\n\nExecution of Loop Over Items node\n\nThe **Loop Over Items node** stops executing after all the incoming items get divided into batches and passed on to the next node in the workflow, so it's not necessary to add an **If node** to stop the loop.\n\n### Loop/Batch Exercise\n\nBuild a workflow that reads the RSS feed from Medium and dev.to. The workflow should consist of three nodes:\n\n1. A **Code node** that returns the URLs of the RSS feeds of Medium (`https://medium.com/feed/n8n-io`) and dev.to (`https://dev.to/feed/n8n`).\n1. A **Loop Over Items node** with `Batch Size: 1`, that takes in the inputs from the **Code node** and **RSS Read node** and iterates over the items.\n1. An **RSS Read node** that gets the URL of the Medium RSS feed, passed as an expression: `{{ $json.url }}`.\n   - The **RSS Read node** is one of the [exception nodes](../../../flow-logic/looping/#node-exceptions) which processes only the first item it receives, so the **Loop Over Items node** is necessary for iterating over multiple items.\n\n1. Add a **Code Node**. You can format the code in several ways, one way is:\n   - Set **Mode** to `Run Once for All Items`.\n\n- Set **Language** to `JavaScript`.\n\n- Copy the code below and paste it into the JavaScript Code editor:\n\n1. Add a **Loop Over Items node** connected to the **Code node**.\n   - Set **Batch Size** to `1`.\n1. The **Loop Over Items node** automatically adds a node called \"Replace Me\". Replace that node with an **RSS Read node**.\n   - Set the **URL** to use the url from the Code Node: `{{ $json.url }}`.\n\nThe workflow for this exercise looks like this:\n\n*Workflow for getting RSS feeds from two blogs*\n\nTo check the configuration of the nodes, you can copy the JSON workflow code below and paste it into your Editor UI:",
  "code_samples": [
    {
      "code": "{\n\"meta\": {\n\t\"templateCredsSetupCompleted\": true,\n\t\"instanceId\": \"cb484ba7b742928a2048bf8829668bed5b5ad9787579adea888f05980292a4a7\"\n},\n\"nodes\": [\n\t{\n\t\"parameters\": {\n\t\t\"mode\": \"combine\",\n\t\t\"mergeByFields\": {\n\t\t\"values\": [\n\t\t\t{\n\t\t\t\"field1\": \"name\",\n\t\t\t\"field2\": \"name\"\n\t\t\t}\n\t\t]\n\t\t},\n\t\t\"options\": {}\n\t},\n\t\"id\": \"578365f3-26dd-4fa6-9858-f0a5fdfc413b\",\n\t\"name\": \"Merge\",\n\t\"type\": \"n8n-nodes-base.merge\",\n\t\"typeVersion\": 2.1,\n\t\"position\": [\n\t\t720,\n\t\t580\n\t]\n\t},\n\t{\n\t\"parameters\": {},\n\t\"id\": \"71aa5aad-afdf-4f8a-bca0-34450eee8acc\",\n\t\"name\": \"When clicking \\\"Execute workflow\\\"\",\n\t\"type\": \"n8n-nodes-base.manualTrigger\",\n\t\"typeVersion\": 1,\n\t\"position\": [\n\t\t260,\n\t\t560\n\t]\n\t},\n\t{\n\t\"parameters\": {\n\t\t\"operation\": \"getAllPeople\"\n\t},\n\t\"id\": \"497174fe-3cab-4160-8103-78b44efd038d\",\n\t\"name\": \"Customer Datastore (n8n training)\",\n\t\"type\": \"n8n-nodes-base.n8nTrainingCustomerDatastore\",\n\t\"typeVersion\": 1,\n\t\"position\": [\n\t\t500,\n\t\t460\n\t]\n\t},\n\t{\n\t\"parameters\": {\n\t\t\"jsCode\": \"return [\\n  {\\n    'name': 'Jay Gatsby',\\n    'language': 'English',\\n    'country': {\\n      'code': 'US',\\n      'name': 'United States'\\n    }\\n    \\n  }\\n  \\n];\"\n\t},\n\t\"id\": \"387e8a1e-e796-4f05-8e75-7ce25c786c5f\",\n\t\"name\": \"Code\",\n\t\"type\": \"n8n-nodes-base.code\",\n\t\"typeVersion\": 2,\n\t\"position\": [\n\t\t500,\n\t\t720\n\t]\n\t}\n],\n\"connections\": {\n\t\"When clicking \\\"Execute workflow\\\"\": {\n\t\"main\": [\n\t\t[\n\t\t{\n\t\t\t\"node\": \"Customer Datastore (n8n training)\",\n\t\t\t\"type\": \"main\",\n\t\t\t\"index\": 0\n\t\t},\n\t\t{\n\t\t\t\"node\": \"Code\",\n\t\t\t\"type\": \"main\",\n\t\t\t\"index\": 0\n\t\t}\n\t\t]\n\t]\n\t},\n\t\"Customer Datastore (n8n training)\": {\n\t\"main\": [\n\t\t[\n\t\t{\n\t\t\t\"node\": \"Merge\",\n\t\t\t\"type\": \"main\",\n\t\t\t\"index\": 0\n\t\t}\n\t\t]\n\t]\n\t},\n\t\"Code\": {\n\t\"main\": [\n\t\t[\n\t\t{\n\t\t\t\"node\": \"Merge\",\n\t\t\t\"type\": \"main\",\n\t\t\t\"index\": 1\n\t\t}\n\t\t]\n\t]\n\t}\n},\n\"pinData\": {}\n}",
      "language": "unknown"
    },
    {
      "code": "let urls = [\n     \t{\n     \t\tjson: {\n     \t\turl: 'https://medium.com/feed/n8n-io'\n     \t\t}\n     \t},\n     \t{\n     \tjson: {\n     \t\turl: 'https://dev.to/feed/n8n'\n     \t\t} \n     \t}\n     ]\n     return urls;",
      "language": "unknown"
    },
    {
      "code": "{\n\"meta\": {\n\t\"templateCredsSetupCompleted\": true,\n\t\"instanceId\": \"cb484ba7b742928a2048bf8829668bed5b5ad9787579adea888f05980292a4a7\"\n},\n\"nodes\": [\n\t{\n\t\"parameters\": {},\n\t\"id\": \"ed8dc090-ae8c-4db6-a93b-0fa873015c25\",\n\t\"name\": \"When clicking \\\"Execute workflow\\\"\",\n\t\"type\": \"n8n-nodes-base.manualTrigger\",\n\t\"typeVersion\": 1,\n\t\"position\": [\n\t\t460,\n\t\t460\n\t]\n\t},\n\t{\n\t\"parameters\": {\n\t\t\"jsCode\": \"let urls = [\\n  {\\n    json: {\\n      url: 'https://medium.com/feed/n8n-io'\\n    }\\n  },\\n  {\\n   json: {\\n     url: 'https://dev.to/feed/n8n'\\n   } \\n  }\\n]\\n\\nreturn urls;\"\n\t},\n\t\"id\": \"1df2a9bf-f970-4e04-b906-92dbbc9e8d3a\",\n\t\"name\": \"Code\",\n\t\"type\": \"n8n-nodes-base.code\",\n\t\"typeVersion\": 2,\n\t\"position\": [\n\t\t680,\n\t\t460\n\t]\n\t},\n\t{\n\t\"parameters\": {\n\t\t\"options\": {}\n\t},\n\t\"id\": \"3cce249a-0eab-42e2-90e3-dbdf3684e012\",\n\t\"name\": \"Loop Over Items\",\n\t\"type\": \"n8n-nodes-base.splitInBatches\",\n\t\"typeVersion\": 3,\n\t\"position\": [\n\t\t900,\n\t\t460\n\t]\n\t},\n\t{\n\t\"parameters\": {\n\t\t\"url\": \"={{ $json.url }}\",\n\t\t\"options\": {}\n\t},\n\t\"id\": \"50e1c1dc-9a5d-42d3-b7c0-accc31636aa6\",\n\t\"name\": \"RSS Read\",\n\t\"type\": \"n8n-nodes-base.rssFeedRead\",\n\t\"typeVersion\": 1,\n\t\"position\": [\n\t\t1120,\n\t\t460\n\t]\n\t}\n],\n\"connections\": {\n\t\"When clicking \\\"Execute workflow\\\"\": {\n\t\"main\": [\n\t\t[\n\t\t{\n\t\t\t\"node\": \"Code\",\n\t\t\t\"type\": \"main\",\n\t\t\t\"index\": 0\n\t\t}\n\t\t]\n\t]\n\t},\n\t\"Code\": {\n\t\"main\": [\n\t\t[\n\t\t{\n\t\t\t\"node\": \"Loop Over Items\",\n\t\t\t\"type\": \"main\",\n\t\t\t\"index\": 0\n\t\t}\n\t\t]\n\t]\n\t},\n\t\"Loop Over Items\": {\n\t\"main\": [\n\t\tnull,\n\t\t[\n\t\t{\n\t\t\t\"node\": \"RSS Read\",\n\t\t\t\"type\": \"main\",\n\t\t\t\"index\": 0\n\t\t}\n\t\t]\n\t]\n\t},\n\t\"RSS Read\": {\n\t\"main\": [\n\t\t[\n\t\t{\n\t\t\t\"node\": \"Loop Over Items\",\n\t\t\t\"type\": \"main\",\n\t\t\t\"index\": 0\n\t\t}\n\t\t]\n\t]\n\t}\n},\n\"pinData\": {}\n}",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Merging data",
      "id": "merging-data"
    },
    {
      "level": "h3",
      "text": "Merge Exercise",
      "id": "merge-exercise"
    },
    {
      "level": "h2",
      "text": "Looping",
      "id": "looping"
    },
    {
      "level": "h2",
      "text": "Splitting data in batches",
      "id": "splitting-data-in-batches"
    },
    {
      "level": "h3",
      "text": "Loop/Batch Exercise",
      "id": "loop/batch-exercise"
    }
  ],
  "url": "llms-txt#merging-and-splitting-data",
  "links": []
}
{
  "url": "https://nextjs.org/docs/architecture/nextjs-compiler",
  "title": "Next.js Compiler",
  "content": "The Next.js Compiler, written in Rust using SWC, allows Next.js to transform and minify your JavaScript code for production. This replaces Babel for individual files and Terser for minifying output bundles.\n\nCompilation using the Next.js Compiler is 17x faster than Babel and enabled by default since Next.js version 12. If you have an existing Babel configuration or are using unsupported features, your application will opt-out of the Next.js Compiler and continue using Babel.\n\nSWC is an extensible Rust-based platform for the next generation of fast developer tools.\n\nSWC can be used for compilation, minification, bundling, and more â€“ and is designed to be extended. It's something you can call to perform code transformations (either built-in or custom). Running those transformations happens through higher-level tools like Next.js.\n\nWe chose to build on SWC for a few reasons:\n\nWe're working to port babel-plugin-styled-components to the Next.js Compiler.\n\nFirst, update to the latest version of Next.js: npm install next@latest. Then, update your next.config.js file:\n\nFor advanced use cases, you can configure individual properties for styled-components compilation.\n\nNote: ssr and displayName transforms are the main requirement for using styled-components in Next.js.\n\nThe Next.js Compiler transpiles your tests and simplifies configuring Jest together with Next.js including:\n\nFirst, update to the latest version of Next.js: npm install next@latest. Then, update your jest.config.js file:\n\nTo enable Relay support:\n\nGood to know: In Next.js, all JavaScript files in pages directory are considered routes. So, for relay-compiler you'll need to specify artifactDirectory configuration settings outside of the pages, otherwise relay-compiler will generate files next to the source file in the __generated__ directory, and this file will be considered a route, which will break production builds.\n\nAllows to remove JSX properties. This is often used for testing. Similar to babel-plugin-react-remove-properties.\n\nTo remove properties matching the default regex ^data-test:\n\nTo remove custom properties:\n\nThis transform allows for removing all console.* calls in application code (not node_modules). Similar to babel-plugin-transform-remove-console.\n\nRemove all console.* calls:\n\nRemove console.* output except console.error:\n\nNext.js will automatically detect experimentalDecorators in jsconfig.json or tsconfig.json. Legacy decorators are commonly used with older versions of libraries like mobx.\n\nThis flag is only supported for compatibility with existing applications. We do not recommend using legacy decorators in new applications.\n\nFirst, update to the latest version of Next.js: npm install next@latest. Then, update your jsconfig.json or tsconfig.json file:\n\nNext.js will automatically detect jsxImportSource in jsconfig.json or tsconfig.json and apply that. This is commonly used with libraries like Theme UI.\n\nFirst, update to the latest version of Next.js: npm install next@latest. Then, update your jsconfig.json or tsconfig.json file:\n\nWe're working to port @emotion/babel-plugin to the Next.js Compiler.\n\nFirst, update to the latest version of Next.js: npm install next@latest. Then, update your next.config.js file:\n\nNext.js' swc compiler is used for minification by default since v13. This is 7x faster than Terser.\n\nGood to know: Starting with v15, minification cannot be customized using next.config.js. Support for the swcMinify flag has been removed.\n\nNext.js can automatically transpile and bundle dependencies from local packages (like monorepos) or from external dependencies (node_modules). This replaces the next-transpile-modules package.\n\nThis option has been superseded by optimizePackageImports in Next.js 13.5. We recommend upgrading to use the new option that does not require manual configuration of import paths.\n\nThe define option allows you to statically replace variables in your code at build-time. The option takes an object as key-value pairs, where the keys are the variables that should be replaced with the corresponding values.\n\nUse the compiler.define field in next.config.js to define variables for all environments (server, edge, and client). Or, use compiler.defineServer to define variables only for server-side (server and edge) code:\n\nThe Next.js Compiler supports lifecycle hooks that allow you to run custom code at specific points during the build process. Currently, the following hook is supported:\n\nA hook function that executes after production build compilation finishes, but before running post-compilation tasks such as type checking and static page generation. This hook provides access to project metadata including the project directory and build output directory, making it useful for third-party tools to collect build outputs like sourcemaps.\n\nThe hook receives an object with the following properties:\n\nYou can generate SWC's internal transform traces as chromium's trace event format.\n\nOnce enabled, swc will generate trace named as swc-trace-profile-${timestamp}.json under .next/. Chromium's trace viewer (chrome://tracing/, https://ui.perfetto.dev/), or compatible flamegraph viewer (https://www.speedscope.app/) can load & visualize generated traces.\n\nYou can configure swc's transform to use SWC's experimental plugin support written in wasm to customize transformation behavior.\n\nswcPlugins accepts an array of tuples for configuring plugins. A tuple for the plugin contains the path to the plugin and an object for plugin configuration. The path to the plugin can be an npm module package name or an absolute path to the .wasm binary itself.\n\nWhen your application has a .babelrc file, Next.js will automatically fall back to using Babel for transforming individual files. This ensures backwards compatibility with existing applications that leverage custom Babel plugins.\n\nIf you're using a custom Babel setup, please share your configuration. We're working to port as many commonly used Babel transformations as possible, as well as supporting plugins in the future.",
  "headings": [
    {
      "level": "h1",
      "text": "Next.js Compiler",
      "id": ""
    },
    {
      "level": "h2",
      "text": "Why SWC?",
      "id": "why-swc"
    },
    {
      "level": "h2",
      "text": "Supported Features",
      "id": "supported-features"
    },
    {
      "level": "h3",
      "text": "Styled Components",
      "id": "styled-components"
    },
    {
      "level": "h3",
      "text": "Jest",
      "id": "jest"
    },
    {
      "level": "h3",
      "text": "Relay",
      "id": "relay"
    },
    {
      "level": "h3",
      "text": "Remove React Properties",
      "id": "remove-react-properties"
    },
    {
      "level": "h3",
      "text": "Remove Console",
      "id": "remove-console"
    },
    {
      "level": "h3",
      "text": "Legacy Decorators",
      "id": "legacy-decorators"
    },
    {
      "level": "h3",
      "text": "importSource",
      "id": "importsource"
    },
    {
      "level": "h3",
      "text": "Emotion",
      "id": "emotion"
    },
    {
      "level": "h3",
      "text": "Minification",
      "id": "minification"
    },
    {
      "level": "h3",
      "text": "Module Transpilation",
      "id": "module-transpilation"
    },
    {
      "level": "h3",
      "text": "Modularize Imports",
      "id": "modularize-imports"
    },
    {
      "level": "h3",
      "text": "Define (Replacing variables during build)",
      "id": "define-replacing-variables-during-build"
    },
    {
      "level": "h3",
      "text": "Build Lifecycle Hooks",
      "id": "build-lifecycle-hooks"
    },
    {
      "level": "h4",
      "text": "runAfterProductionCompile",
      "id": "runafterproductioncompile"
    },
    {
      "level": "h2",
      "text": "Experimental Features",
      "id": "experimental-features"
    },
    {
      "level": "h3",
      "text": "SWC Trace profiling",
      "id": "swc-trace-profiling"
    },
    {
      "level": "h3",
      "text": "SWC Plugins (experimental)",
      "id": "swc-plugins-experimental"
    },
    {
      "level": "h2",
      "text": "Unsupported Features",
      "id": "unsupported-features"
    },
    {
      "level": "h2",
      "text": "Version History",
      "id": "version-history"
    }
  ],
  "code_samples": [
    {
      "code": "module.exports = {\n  compiler: {\n    styledComponents: true,\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  compiler: {\n    // see https://styled-components.com/docs/tooling#babel-plugin for more info on the options.\n    styledComponents: {\n      // Enabled by default in development, disabled in production to reduce file size,\n      // setting this will override the default for all environments.\n      displayName?: boolean,\n      // Enabled by default.\n      ssr?: boolean,\n      // Enabled by default.\n      fileName?: boolean,\n      // Empty by default.\n      topLevelImportPaths?: string[],\n      // Defaults to [\"index\"].\n      meaninglessFileNames?: string[],\n      // Enabled by default.\n      minify?: boolean,\n      // Enabled by default.\n      transpileTemplateLiterals?: boolean,\n      // Empty by default.\n      namespace?: string,\n      // Disabled by default.\n      pure?: boolean,\n      // Enabled by default.\n      cssProp?: boolean,\n    },\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "const nextJest = require('next/jest')\n \n// Providing the path to your Next.js app which will enable loading next.config.js and .env files\nconst createJestConfig = nextJest({ dir: './' })\n \n// Any custom config you want to pass to Jest\nconst customJestConfig = {\n  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],\n}\n \n// createJestConfig is exported in this way to ensure that next/jest can load the Next.js configuration, which is async\nmodule.exports = createJestConfig(customJestConfig)",
      "language": "javascript"
    },
    {
      "code": "module.exports = {\n  compiler: {\n    relay: {\n      // This should match relay.config.js\n      src: './',\n      artifactDirectory: './__generated__',\n      language: 'typescript',\n      eagerEsModules: false,\n    },\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  compiler: {\n    reactRemoveProperties: true,\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  compiler: {\n    // The regexes defined here are processed in Rust so the syntax is different from\n    // JavaScript `RegExp`s. See https://docs.rs/regex.\n    reactRemoveProperties: { properties: ['^data-custom$'] },\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  compiler: {\n    removeConsole: true,\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  compiler: {\n    removeConsole: {\n      exclude: ['error'],\n    },\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "{\n  \"compilerOptions\": {\n    \"experimentalDecorators\": true\n  }\n}",
      "language": "unknown"
    },
    {
      "code": "{\n  \"compilerOptions\": {\n    \"jsxImportSource\": \"theme-ui\"\n  }\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  compiler: {\n    emotion: boolean | {\n      // default is true. It will be disabled when build type is production.\n      sourceMap?: boolean,\n      // default is 'dev-only'.\n      autoLabel?: 'never' | 'dev-only' | 'always',\n      // default is '[local]'.\n      // Allowed values: `[local]` `[filename]` and `[dirname]`\n      // This option only works when autoLabel is set to 'dev-only' or 'always'.\n      // It allows you to define the format of the resulting label.\n      // The format is defined via string where variable parts are enclosed in square brackets [].\n      // For example labelFormat: \"my-classname--[local]\", where [local] will be replaced with the name of the variable the result is assigned to.\n      labelFormat?: string,\n      // default is undefined.\n      // This option allows you to tell the compiler what imports it should\n      // look at to determine what it should transform so if you re-export\n      // Emotion's exports, you can still use transforms.\n      importMap?: {\n        [packageName: string]: {\n          [exportName: string]: {\n            canonicalImport?: [string, string],\n            styledBaseImport?: [string, string],\n          }\n        }\n      },\n    },\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  transpilePackages: ['@acme/ui', 'lodash-es'],\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  compiler: {\n    define: {\n      MY_VARIABLE: 'my-string',\n      'process.env.MY_ENV_VAR': 'my-env-var',\n    },\n    defineServer: {\n      MY_SERVER_VARIABLE: 'my-server-var',\n    },\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  compiler: {\n    runAfterProductionCompile: async ({ distDir, projectDir }) => {\n      // Your custom code here\n    },\n  },\n}",
      "language": "javascript"
    },
    {
      "code": "module.exports = {\n  experimental: {\n    swcTraceProfiling: true,\n  },\n}",
      "language": "unknown"
    },
    {
      "code": "module.exports = {\n  experimental: {\n    swcPlugins: [\n      [\n        'plugin',\n        {\n          ...pluginOptions,\n        },\n      ],\n    ],\n  },\n}",
      "language": "unknown"
    }
  ],
  "patterns": [],
  "links": [
    "https://nextjs.org/docs",
    "https://nextjs.org/docs/architecture",
    "https://nextjs.org/docs/architecture/nextjs-compiler",
    "https://nextjs.org/docs/app/api-reference/config/next-config-js/optimizePackageImports",
    "https://nextjs.org/docs/architecture/fast-refresh",
    "https://nextjs.org/docs/architecture/supported-browsers"
  ]
}
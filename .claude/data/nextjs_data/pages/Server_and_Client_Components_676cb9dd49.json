{
  "url": "https://nextjs.org/docs/app/getting-started/server-and-client-components",
  "title": "Server and Client Components",
  "content": "By default, layouts and pages are Server Components, which lets you fetch data and render parts of your UI on the server, optionally cache the result, and stream it to the client. When you need interactivity or browser APIs, you can use Client Components to layer in functionality.\n\nThis page explains how Server and Client Components work in Next.js and when to use them, with examples of how to compose them together in your application.\n\nThe client and server environments have different capabilities. Server and Client components allow you to run logic in each environment depending on your use case.\n\nUse Client Components when you need:\n\nUse Server Components when you need:\n\nFor example, the <Page> component is a Server Component that fetches data about a post, and passes it as props to the <LikeButton> which handles client-side interactivity.\n\nOn the server, Next.js uses React's APIs to orchestrate rendering. The rendering work is split into chunks, by individual route segments (layouts and pages):\n\nWhat is the React Server Component Payload (RSC)?\n\nThe RSC Payload is a compact binary representation of the rendered React Server Components tree. It's used by React on the client to update the browser's DOM. The RSC Payload contains:\n\nHydration is React's process for attaching event handlers to the DOM, to make the static HTML interactive.\n\nOn subsequent navigations:\n\nYou can create a Client Component by adding the \"use client\" directive at the top of the file, above your imports.\n\n\"use client\" is used to declare a boundary between the Server and Client module graphs (trees).\n\nOnce a file is marked with \"use client\", all its imports and child components are considered part of the client bundle. This means you don't need to add the directive to every component that is intended for the client.\n\nTo reduce the size of your client JavaScript bundles, add 'use client' to specific interactive components instead of marking large parts of your UI as Client Components.\n\nFor example, the <Layout> component contains mostly static elements like a logo and navigation links, but includes an interactive search bar. <Search /> is interactive and needs to be a Client Component, however, the rest of the layout can remain a Server Component.\n\nYou can pass data from Server Components to Client Components using props.\n\nAlternatively, you can stream data from a Server Component to a Client Component with the use Hook. See an example.\n\nGood to know: Props passed to Client Components need to be serializable by React.\n\nYou can pass Server Components as a prop to a Client Component. This allows you to visually nest server-rendered UI within Client components.\n\nA common pattern is to use children to create a slot in a <ClientComponent>. For example, a <Cart> component that fetches data on the server, inside a <Modal> component that uses client state to toggle visibility.\n\nThen, in a parent Server Component (e.g.<Page>), you can pass a <Cart> as the child of the <Modal>:\n\nIn this pattern, all Server Components will be rendered on the server ahead of time, including those as props. The resulting RSC payload will contain references of where Client Components should be rendered within the component tree.\n\nReact context is commonly used to share global state like the current theme. However, React context is not supported in Server Components.\n\nTo use context, create a Client Component that accepts children:\n\nThen, import it into a Server Component (e.g. layout):\n\nYour Server Component will now be able to directly render your provider, and all other Client Components throughout your app will be able to consume this context.\n\nGood to know: You should render providers as deep as possible in the tree – notice how ThemeProvider only wraps {children} instead of the entire <html> document. This makes it easier for Next.js to optimize the static parts of your Server Components.\n\nWhen using a third-party component that relies on client-only features, you can wrap it in a Client Component to ensure it works as expected.\n\nFor example, the <Carousel /> can be imported from the acme-carousel package. This component uses useState, but it doesn't yet have the \"use client\" directive.\n\nIf you use <Carousel /> within a Client Component, it will work as expected:\n\nHowever, if you try to use it directly within a Server Component, you'll see an error. This is because Next.js doesn't know <Carousel /> is using client-only features.\n\nTo fix this, you can wrap third-party components that rely on client-only features in your own Client Components:\n\nNow, you can use <Carousel /> directly within a Server Component:\n\nAdvice for Library Authors\n\nIf you’re building a component library, add the \"use client\" directive to entry points that rely on client-only features. This lets your users import components into Server Components without needing to create wrappers.\n\nIt's worth noting some bundlers might strip out \"use client\" directives. You can find an example of how to configure esbuild to include the \"use client\" directive in the React Wrap Balancer and Vercel Analytics repositories.\n\nJavaScript modules can be shared between both Server and Client Components modules. This means it's possible to accidentally import server-only code into the client. For example, consider the following function:\n\nThis function contains an API_KEY that should never be exposed to the client.\n\nIn Next.js, only environment variables prefixed with NEXT_PUBLIC_ are included in the client bundle. If variables are not prefixed, Next.js replaces them with an empty string.\n\nAs a result, even though getData() can be imported and executed on the client, it won't work as expected.\n\nTo prevent accidental usage in Client Components, you can use the server-only package.\n\nThen, import the package into a file that contains server-only code:\n\nNow, if you try to import the module into a Client Component, there will be a build-time error.\n\nThe corresponding client-only package can be used to mark modules that contain client-only logic like code that accesses the window object.\n\nIn Next.js, installing server-only or client-only is optional. However, if your linting rules flag extraneous dependencies, you may install them to avoid issues.\n\nNext.js handles server-only and client-only imports internally to provide clearer error messages when a module is used in the wrong environment. The contents of these packages from NPM are not used by Next.js.\n\nNext.js also provides its own type declarations for server-only and client-only, for TypeScript configurations where noUncheckedSideEffectImports is active.",
  "headings": [
    {
      "level": "h1",
      "text": "Server and Client Components",
      "id": ""
    },
    {
      "level": "h2",
      "text": "When to use Server and Client Components?",
      "id": "when-to-use-server-and-client-components"
    },
    {
      "level": "h2",
      "text": "How do Server and Client Components work in Next.js?",
      "id": "how-do-server-and-client-components-work-in-nextjs"
    },
    {
      "level": "h3",
      "text": "On the server",
      "id": "on-the-server"
    },
    {
      "level": "h3",
      "text": "On the client (first load)",
      "id": "on-the-client-first-load"
    },
    {
      "level": "h3",
      "text": "Subsequent Navigations",
      "id": "subsequent-navigations"
    },
    {
      "level": "h2",
      "text": "Examples",
      "id": "examples"
    },
    {
      "level": "h3",
      "text": "Using Client Components",
      "id": "using-client-components"
    },
    {
      "level": "h3",
      "text": "Reducing JS bundle size",
      "id": "reducing-js-bundle-size"
    },
    {
      "level": "h3",
      "text": "Passing data from Server to Client Components",
      "id": "passing-data-from-server-to-client-components"
    },
    {
      "level": "h3",
      "text": "Interleaving Server and Client Components",
      "id": "interleaving-server-and-client-components"
    },
    {
      "level": "h3",
      "text": "Context providers",
      "id": "context-providers"
    },
    {
      "level": "h3",
      "text": "Third-party components",
      "id": "third-party-components"
    },
    {
      "level": "h3",
      "text": "Preventing environment poisoning",
      "id": "preventing-environment-poisoning"
    },
    {
      "level": "h2",
      "text": "Next Steps",
      "id": "next-steps"
    },
    {
      "level": "h3",
      "text": "use client",
      "id": ""
    }
  ],
  "code_samples": [
    {
      "code": "import LikeButton from '@/app/ui/like-button'\nimport { getPost } from '@/lib/data'\n \nexport default async function Page({\n  params,\n}: {\n  params: Promise<{ id: string }>\n}) {\n  const { id } = await params\n  const post = await getPost(id)\n \n  return (\n    <div>\n      <main>\n        <h1>{post.title}</h1>\n        {/* ... */}\n        <LikeButton likes={post.likes} />\n      </main>\n    </div>\n  )\n}",
      "language": "python"
    },
    {
      "code": "'use client'\n \nimport { useState } from 'react'\n \nexport default function LikeButton({ likes }: { likes: number }) {\n  // ...\n}",
      "language": "python"
    },
    {
      "code": "'use client'\n \nimport { useState } from 'react'\n \nexport default function Counter() {\n  const [count, setCount] = useState(0)\n \n  return (\n    <div>\n      <p>{count} likes</p>\n      <button onClick={() => setCount(count + 1)}>Click me</button>\n    </div>\n  )\n}",
      "language": "python"
    },
    {
      "code": "// Client Component\nimport Search from './search'\n// Server Component\nimport Logo from './logo'\n \n// Layout is a Server Component by default\nexport default function Layout({ children }: { children: React.ReactNode }) {\n  return (\n    <>\n      <nav>\n        <Logo />\n        <Search />\n      </nav>\n      <main>{children}</main>\n    </>\n  )\n}",
      "language": "python"
    },
    {
      "code": "'use client'\n \nexport default function Search() {\n  // ...\n}",
      "language": "unknown"
    },
    {
      "code": "import LikeButton from '@/app/ui/like-button'\nimport { getPost } from '@/lib/data'\n \nexport default async function Page({\n  params,\n}: {\n  params: Promise<{ id: string }>\n}) {\n  const { id } = await params\n  const post = await getPost(id)\n \n  return <LikeButton likes={post.likes} />\n}",
      "language": "python"
    },
    {
      "code": "'use client'\n \nexport default function LikeButton({ likes }: { likes: number }) {\n  // ...\n}",
      "language": "unknown"
    },
    {
      "code": "'use client'\n \nexport default function Modal({ children }: { children: React.ReactNode }) {\n  return <div>{children}</div>\n}",
      "language": "unknown"
    },
    {
      "code": "import Modal from './ui/modal'\nimport Cart from './ui/cart'\n \nexport default function Page() {\n  return (\n    <Modal>\n      <Cart />\n    </Modal>\n  )\n}",
      "language": "python"
    },
    {
      "code": "'use client'\n \nimport { createContext } from 'react'\n \nexport const ThemeContext = createContext({})\n \nexport default function ThemeProvider({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return <ThemeContext.Provider value=\"dark\">{children}</ThemeContext.Provider>\n}",
      "language": "python"
    },
    {
      "code": "import ThemeProvider from './theme-provider'\n \nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <html>\n      <body>\n        <ThemeProvider>{children}</ThemeProvider>\n      </body>\n    </html>\n  )\n}",
      "language": "python"
    },
    {
      "code": "'use client'\n \nimport { useState } from 'react'\nimport { Carousel } from 'acme-carousel'\n \nexport default function Gallery() {\n  const [isOpen, setIsOpen] = useState(false)\n \n  return (\n    <div>\n      <button onClick={() => setIsOpen(true)}>View pictures</button>\n      {/* Works, since Carousel is used within a Client Component */}\n      {isOpen && <Carousel />}\n    </div>\n  )\n}",
      "language": "python"
    },
    {
      "code": "'use client'\n \nimport { Carousel } from 'acme-carousel'\n \nexport default Carousel",
      "language": "python"
    },
    {
      "code": "import Carousel from './carousel'\n \nexport default function Page() {\n  return (\n    <div>\n      <p>View pictures</p>\n      {/*  Works, since Carousel is a Client Component */}\n      <Carousel />\n    </div>\n  )\n}",
      "language": "python"
    },
    {
      "code": "export async function getData() {\n  const res = await fetch('https://external-service.com/data', {\n    headers: {\n      authorization: process.env.API_KEY,\n    },\n  })\n \n  return res.json()\n}",
      "language": "javascript"
    },
    {
      "code": "import 'server-only'\n \nexport async function getData() {\n  const res = await fetch('https://external-service.com/data', {\n    headers: {\n      authorization: process.env.API_KEY,\n    },\n  })\n \n  return res.json()\n}",
      "language": "javascript"
    },
    {
      "code": "pnpm add server-only",
      "language": "unknown"
    }
  ],
  "patterns": [],
  "links": [
    "https://nextjs.org/docs/app",
    "https://nextjs.org/docs/app/getting-started",
    "https://nextjs.org/docs/app/getting-started/server-and-client-components",
    "https://nextjs.org/docs/app/getting-started/layouts-and-pages",
    "https://nextjs.org/docs/app/guides/caching",
    "https://nextjs.org/docs/app/getting-started/fetching-data",
    "https://nextjs.org/docs/app/api-reference/directives/use-client",
    "https://nextjs.org/docs/app/getting-started/linking-and-navigating",
    "https://nextjs.org/docs/app/getting-started/cache-components"
  ]
}
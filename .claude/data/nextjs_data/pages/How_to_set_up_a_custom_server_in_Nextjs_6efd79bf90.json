{
  "url": "https://nextjs.org/docs/pages/guides/custom-server",
  "title": "How to set up a custom server in Next.js",
  "content": "Next.js includes its own server with next start by default. If you have an existing backend, you can still use it with Next.js (this is not a custom server). A custom Next.js server allows you to programmatically start a server for custom patterns. The majority of the time, you will not need this approach. However, it's available if you need to eject.\n\nTake a look at the following example of a custom server:\n\nserver.js does not run through the Next.js Compiler or bundling process. Make sure the syntax and source code this file requires are compatible with the current Node.js version you are using. View an example.\n\nTo run the custom server, you'll need to update the scripts in package.json like so:\n\nAlternatively, you can set up nodemon (example). The custom server uses the following import to connect the server with the Next.js application:\n\nThe above next import is a function that receives an object with the following options:\n\nThe returned app can then be used to let Next.js handle requests as required.\n\nBy default, Next will serve each file in the pages folder under a pathname matching the filename. If your project uses a custom server, this behavior may result in the same content being served from multiple paths, which can present problems with SEO and UX.\n\nTo disable this behavior and prevent routing based on files in pages, open next.config.js and disable the useFileSystemPublicRoutes config:\n\nNote that useFileSystemPublicRoutes disables filename routes from SSR; client-side routing may still access those paths. When using this option, you should guard against navigation to routes you do not want programmatically.\n\nYou may also wish to configure the client-side router to disallow client-side redirects to filename routes; for that refer to router.beforePopState.",
  "headings": [
    {
      "level": "h1",
      "text": "How to set up a custom server in Next.js",
      "id": ""
    },
    {
      "level": "h2",
      "text": "Disabling file-system routing",
      "id": "disabling-file-system-routing"
    }
  ],
  "code_samples": [
    {
      "code": "import { createServer } from 'http'\nimport { parse } from 'url'\nimport next from 'next'\n \nconst port = parseInt(process.env.PORT || '3000', 10)\nconst dev = process.env.NODE_ENV !== 'production'\nconst app = next({ dev })\nconst handle = app.getRequestHandler()\n \napp.prepare().then(() => {\n  createServer((req, res) => {\n    const parsedUrl = parse(req.url!, true)\n    handle(req, res, parsedUrl)\n  }).listen(port)\n \n  console.log(\n    `> Server listening at http://localhost:${port} as ${\n      dev ? 'development' : process.env.NODE_ENV\n    }`\n  )\n})",
      "language": "python"
    },
    {
      "code": "{\n  \"scripts\": {\n    \"dev\": \"node server.js\",\n    \"build\": \"next build\",\n    \"start\": \"NODE_ENV=production node server.js\"\n  }\n}",
      "language": "unknown"
    },
    {
      "code": "import next from 'next'\n \nconst app = next({})",
      "language": "python"
    },
    {
      "code": "module.exports = {\n  useFileSystemPublicRoutes: false,\n}",
      "language": "unknown"
    }
  ],
  "patterns": [],
  "links": [
    "https://nextjs.org/docs/pages",
    "https://nextjs.org/docs/pages/guides",
    "https://nextjs.org/docs/pages/building-your-application/rendering/automatic-static-optimization",
    "https://nextjs.org/docs/pages/guides/custom-server",
    "https://nextjs.org/docs/pages/api-reference/functions/use-router",
    "https://nextjs.org/docs/pages/guides/css-in-js",
    "https://nextjs.org/docs/pages/guides/debugging"
  ]
}